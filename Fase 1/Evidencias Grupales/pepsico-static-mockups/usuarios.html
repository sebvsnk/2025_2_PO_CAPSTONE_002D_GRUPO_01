<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Administraci√≥n de usuarios ‚Äì MVP PepsiCo</title>
  <link rel="stylesheet" href="assets/styles.css">
  <script defer src="assets/app.js"></script>
  <style>
    :root{
      --blue-dark:#28458E; --blue-mid:#1b3487; --blue-deep:#142a6c;
      --muted:#64748b; --line:#e5e7eb; --green:#00984A; --orange:#EB7B30;
    }
    /* HERO */
    .usr-hero{
      background: linear-gradient(90deg,var(--blue-dark),var(--blue-mid) 55%,var(--blue-deep));
      color:#fff; padding:14px 18px; border-radius:14px; margin-bottom:16px;
      box-shadow:0 8px 24px rgba(2,6,23,.10); display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap;
    }
    .usr-hero h2{ margin:0; font-weight:800; font-size:1.25rem; letter-spacing:.2px; color:#fff }
    .usr-chip{display:inline-flex;gap:8px;align-items:center;border:1px solid rgba(255,255,255,.35);background:rgba(255,255,255,.14);border-radius:999px;padding:6px 10px;font-weight:700}

    /* Toolbar */
    .usr-toolbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin:10px 0}
    .usr-input,.usr-select{border:1px solid #dbe3ee;border-radius:10px;padding:10px 12px;background:#fff;outline:none}
    .usr-input:focus,.usr-select:focus{border-color:#3b82f6; box-shadow:0 0 0 3px rgba(59,130,246,.25)}
    .usr-btn{appearance:none;border:0;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer}
    .usr-btn.primary{background:#28458E;color:#fff}
    .usr-btn.secondary{background:#eef2ff;color:#111827;border:1px solid #dbe3ee}
    .usr-btn.danger{background:#fee2e2;color:#7f1d1d}
    .usr-pill{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:#f1f5f9;font-weight:700}
    .usr-right{margin-left:auto}

    /* Tabla */
    .usr-card{border:1px solid #eef2f7;border-radius:14px;background:#fff;overflow:hidden}
    table.usr-table{width:100%;border-collapse:separate;border-spacing:0}
    .usr-table thead th{background:#e8efff;color:#1e3a8a;padding:10px 12px;text-align:left;border-bottom:1px solid #cfe0ff;position:sticky;top:0;z-index:1}
    .usr-table tbody td{padding:12px;border-bottom:1px solid #f1f5f9;vertical-align:middle}
    .usr-row-actions{display:flex;gap:8px;flex-wrap:wrap}

    /* Avatar + nombre */
    .usr-user{display:flex;gap:10px;align-items:center}
    .usr-avatar{width:34px;height:34px;border-radius:50%;background:linear-gradient(135deg,#eff6ff,#e2e8f0);display:grid;place-items:center;font-weight:800;color:#28458E;border:1px solid #dbe3ee}

    /* Badges */
    .usr-badge{display:inline-flex;align-items:center;gap:6px;border-radius:999px;padding:6px 10px;font-weight:700;font-size:.85rem}
    .usr-badge.active{background:#eaf7ef;border:1px solid #c7edd6;color:#0f5132}
    .usr-badge.blocked{background:#fff7ed;border:1px solid #ffddb4;color:#9a3412}

    /* Modal */
    .usr-modal-backdrop{position:fixed;inset:0;background:rgba(2,6,23,.45);display:none;align-items:center;justify-content:center;padding:20px;z-index:50}
    .usr-modal{background:#fff;border-radius:14px;max-width:520px;width:100%;padding:16px;border:1px solid #e5e7eb;box-shadow:0 10px 30px rgba(2,6,23,.15)}
    .usr-modal h3{margin:0 0 10px}
    .usr-modal .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .usr-modal .row > div{display:flex;flex-direction:column;gap:6px}
    .usr-modal label{font-size:.85rem;color:#64748b}
    .usr-modal .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}

    @media (max-width:720px){ .usr-modal .row{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <div class="container">
    <header class="topbar">
      <div class="brand"><span class="mark"></span><span class="word">PEPSICO ¬∑ Taller</span></div>
      <div class="user">
        <button class="btn secondary" onclick="go('index.html')">Salir</button>
      </div>
    </header>
    <div class="layout">
      
    <aside class="sidebar">
      <ul class="nav">
        <li><a href="dashboard.html">üè† Tablero</a></li>
        <li><a href="bitacora.html">üöò Bit√°cora porter√≠a</a></li>
        <li><a href="ot.html">üß∞ OT & Tareas</a></li>
        <li><a href="reportes.html">üìä Reportes</a></li>
        <li><a href="usuarios.html" class="active">üë• Usuarios</a></li>
      </ul>
    </aside>
    
      <main>
        <section class="section">
          <!-- HERO -->
          <div class="usr-hero">
            <h2>üë• Administraci√≥n de usuarios</h2>
            <div class="usr-right"></div>
            <span class="usr-chip">Activos: <b id="statActivos">0</b></span>
            <span class="usr-chip">Bloqueados: <b id="statBloq">0</b></span>
          </div>

          <!-- Toolbar -->
          <div class="usr-toolbar">
            <button class="usr-btn primary" id="btnAdd">‚ûï Agregar usuario</button>
            <input class="usr-input" id="q" placeholder="Buscar por nombre o correo" style="min-width:260px">
            <select class="usr-select" id="fRol">
              <option value="">Rol: Todos</option>
              <option>Porter√≠a</option><option>Mec√°nico</option><option>Supervisor</option><option>Analista</option><option>Admin</option>
            </select>
            <select class="usr-select" id="fEstado">
              <option value="">Estado: Todos</option>
              <option value="Activo">Activo</option>
              <option value="Bloqueado">Bloqueado</option>
            </select>
            <div class="usr-right"></div>
            <span class="usr-pill">Total: <b id="statTotal">0</b></span>
          </div>

          <!-- Tabla -->
          <div class="usr-card">
            <table class="usr-table" id="tabla">
              <thead><tr>
                <th>Nombre</th><th>Correo</th><th>Rol</th><th>Estado</th><th style="width:290px">Acciones</th>
              </tr></thead>
              <tbody id="tbody"></tbody>
            </table>
          </div>
        </section>
      </main>
    </div>
  </div>

  <!-- Modal agregar/editar -->
  <div class="usr-modal-backdrop" id="modalBg" aria-hidden="true">
    <div class="usr-modal" role="dialog" aria-modal="true">
      <h3 id="modalTitle">Agregar usuario</h3>
      <div class="row">
        <div>
          <label>Nombre</label>
          <input class="usr-input" id="mNombre" placeholder="Nombre Apellido">
        </div>
        <div>
          <label>Correo</label>
          <input class="usr-input" id="mCorreo" type="email" placeholder="nombre@pepsico.com">
        </div>
      </div>
      <div class="row">
        <div>
          <label>Rol</label>
          <select class="usr-select" id="mRol">
            <option>Porter√≠a</option><option>Mec√°nico</option><option>Supervisor</option><option>Analista</option><option>Admin</option>
          </select>
        </div>
        <div>
          <label>Estado</label>
          <select class="usr-select" id="mEstado">
            <option>Activo</option><option>Bloqueado</option>
          </select>
        </div>
      </div>
      <div class="actions">
        <button class="usr-btn secondary" id="mCancel">Cancelar</button>
        <button class="usr-btn primary" id="mSave">Guardar</button>
      </div>
    </div>
  </div>

  <script>
    if(typeof go !== 'function'){ function go(href){window.location.href=href;} }

    const KEY = 'usuarios@pepsico';
    let users = JSON.parse(localStorage.getItem(KEY) || '[]');
    if(users.length===0){
      users = [
        {id:crypto.randomUUID(), nombre:'Juan P√©rez', correo:'juan@pepsico.com', rol:'Mec√°nico', estado:'Activo'},
        {id:crypto.randomUUID(), nombre:'Ana Torres',  correo:'ana@pepsico.com',  rol:'Supervisor', estado:'Activo'},
      ];
      persist();
    }

    // DOM
    const tbody = document.getElementById('tbody');
    const q = document.getElementById('q');
    const fRol = document.getElementById('fRol');
    const fEstado = document.getElementById('fEstado');
    const statTotal = document.getElementById('statTotal');
    const statActivos = document.getElementById('statActivos');
    const statBloq = document.getElementById('statBloq');

    // Modal
    const modalBg = document.getElementById('modalBg');
    const mNombre = document.getElementById('mNombre');
    const mCorreo = document.getElementById('mCorreo');
    const mRol = document.getElementById('mRol');
    const mEstado = document.getElementById('mEstado');
    const modalTitle = document.getElementById('modalTitle');
    let editingId = null;

    // Utils
    function persist(){ localStorage.setItem(KEY, JSON.stringify(users)); }
    function initials(name){ return (name||'').split(' ').slice(0,2).map(s=>s[0]||'').join('').toUpperCase(); }
    function openModal(mode='add', user=null){
      modalTitle.textContent = mode==='add'?'Agregar usuario':'Editar usuario';
      editingId = user?.id || null;
      mNombre.value = user?.nombre || '';
      mCorreo.value = user?.correo || '';
      mRol.value = user?.rol || 'Porter√≠a';
      mEstado.value = user?.estado || 'Activo';
      modalBg.style.display='flex';
    }
    function closeModal(){ modalBg.style.display='none'; }

    // Filtros
    function matches(u){
      const term = (q.value||'').toLowerCase();
      const byText = !term || (u.nombre.toLowerCase().includes(term) || u.correo.toLowerCase().includes(term));
      const byRol = !fRol.value || u.rol===fRol.value;
      const byEstado = !fEstado.value || u.estado===fEstado.value;
      return byText && byRol && byEstado;
    }

    // Render
    function render(){
      const list = users.filter(matches);
      tbody.innerHTML = list.map(u=>`
        <tr>
          <td>
            <div class="usr-user">
              <div class="usr-avatar">${initials(u.nombre)}</div>
              <div>
                <div style="font-weight:700">${u.nombre}</div>
                <div style="font-size:.85rem;color:${'#64748b'}">${u.correo}</div>
              </div>
            </div>
          </td>
          <td>${u.correo}</td>
          <td>
            <select class="usr-select" data-act="changeRole" data-id="${u.id}">
              ${['Porter√≠a','Mec√°nico','Supervisor','Analista','Admin'].map(r=>`<option ${r===u.rol?'selected':''}>${r}</option>`).join('')}
            </select>
          </td>
          <td>
            <span class="usr-badge ${u.estado==='Activo'?'active':'blocked'}">${u.estado}</span>
          </td>
          <td>
            <div class="usr-row-actions">
              <button class="usr-btn secondary" data-act="toggle" data-id="${u.id}">${u.estado==='Activo'?'Bloquear':'Desbloquear'}</button>
              <button class="usr-btn secondary" data-act="edit" data-id="${u.id}">Editar</button>
              <button class="usr-btn secondary" data-act="reset" data-id="${u.id}">Reset clave</button>
              <button class="usr-btn danger" data-act="delete" data-id="${u.id}">Eliminar</button>
            </div>
          </td>
        </tr>
      `).join('');

      // Stats
      statTotal.textContent = users.length;
      statActivos.textContent = users.filter(u=>u.estado==='Activo').length;
      statBloq.textContent = users.filter(u=>u.estado!=='Activo').length;
    }

    // Eventos
    document.getElementById('btnAdd').addEventListener('click', ()=>openModal('add'));
    document.getElementById('mCancel').addEventListener('click', closeModal);
    document.getElementById('mSave').addEventListener('click', ()=>{
      const nombre = mNombre.value.trim(), correo = mCorreo.value.trim();
      if(!nombre || !correo){ alert('Completa nombre y correo.'); return; }
      const rol = mRol.value, estado = mEstado.value;
      if(editingId){
        const u = users.find(x=>x.id===editingId); if(!u) return;
        u.nombre=nombre; u.correo=correo; u.rol=rol; u.estado=estado;
      }else{
        users.unshift({id:crypto.randomUUID(), nombre, correo, rol, estado});
      }
      persist(); closeModal(); render();
    });

    q.addEventListener('input', render);
    fRol.addEventListener('change', render);
    fEstado.addEventListener('change', render);

    // Delegaci√≥n de eventos para acciones de fila
    tbody.addEventListener('change', (e)=>{
      const sel = e.target.closest('select[data-act="changeRole"]');
      if(sel){
        const id = sel.dataset.id;
        const u = users.find(x=>x.id===id); if(!u) return;
        u.rol = sel.value; persist(); render();
      }
    });
    tbody.addEventListener('click', (e)=>{
      const btn = e.target.closest('[data-act]'); if(!btn) return;
      const id = btn.dataset.id;
      const u = users.find(x=>x.id===id); if(!u) return;
      const act = btn.dataset.act;
      if(act==='toggle'){ u.estado = u.estado==='Activo'?'Bloqueado':'Activo'; persist(); render(); }
      if(act==='edit'){ openModal('edit', u); }
      if(act==='reset'){ alert('Se enviar√° un correo a '+u.correo+' con instrucciones de restablecimiento.'); }
      if(act==='delete'){
        if(confirm('¬øEliminar a '+u.nombre+'?')){ users = users.filter(x=>x.id!==id); persist(); render(); }
      }
    });

    render();
  </script>
</body>
</html>
